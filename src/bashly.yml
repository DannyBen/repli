name: repli
help: Replicate Workspace Tool
version: 0.1.0

environment_variables:
- name: repli_log_level
  help: Log level
  default: info
  allowed: [debug, info, warn, error]
- name: repli_models_dir
  help: Path to templates dir
  default: "$HOME/repli/models"
- name: replicate_api_token
  help: Replicate API token
  required: true

dependencies: [yq, jq, curl, wget]

commands:
- name: new
  alias: ['n', init]
  help: Create a new configuration file from a tmeplate

  args:
  - name: search
    help: Template search string or an exact name

  flags:
  - long: --output
    short: -o
    arg: path
    help: Path to target file
    default: repli.yaml
  - long: --force
    short: -f
    help: Overwrite target file

  examples:
  - repli new flux

- name: add
  alias: a
  help: Add a new template from a remote Replicate model example

  args:
  - name: model
    help: Replicate model (author/model)
    validate: model_name
    required: true
  - name: name
    help: Template name to save

  flags:
  - long: --force
    short: -f
    help: Overwrite target file

  examples:
  - repli add google/nano-banana banana

- name: get
  alias: g
  help: Call Replicate using a configuration file and save the result

  args:
  - name: prefix
    help: Prefix for saved JSON file and output files

  flags:
  - long: --config
    short: -c
    arg: path
    help: Path to configuration file
    default: repli.yaml
    validate: file_exists

- name: upload
  alias: u
  help: >
    Upload a file to Replicate

    Note that under normal conditions, there should be no reason for you to use this directly. Files will be uploaded automatically as needed.

  args:
  - name: file
    help: Path to file
    validate: file_exists
    required: true

- name: info
  alias: i
  help: Get information on a model
  

  args:
  - name: model
    help: Model name on replicate
    required: true
    validate: model_name

  flags:
  - long: --example
    short: -e
    help: Show the example only
    conflicts: [--schema]
  - long: --schema
    short: -s
    help: Show the schema only
    conflicts: [--example]
  - &plain
    long: --plain
    short: -p
    help: Disable output colors
  - &json
    long: --json
    short: -j
    help: Output JSON instead of YAML

  examples:
  - repli info google/nano-banana
  - repli info google/nano-banana --example --plain --json

- name: files
  alias: f
  help: Show list of uploaded files
  flags: [*plain, *json]

