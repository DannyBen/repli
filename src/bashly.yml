name: repli
help: Replicate AI Workspace Tool
version: 0.1.4

dependencies: [yq, jq, curl, wget]

environment_variables:
- name: replicate_api_token
  help: Replicate API token
  required: true
- name: repli_log_level
  help: Log level
  default: info
  allowed: [debug, info, warn, error]
- name: repli_templates_dir
  help: Path to templates dir
  default: $HOME/repli
- name: repli_file
  help: Name of the repli file
  default: repli.yaml
- name: repli_output_dir
  help: Output directory for all files
  default: .
- name: replicate_host
  help: Replicate host
  default: https://api.replicate.com

variables:
- name: output_dir
  value: $REPLI_OUTPUT_DIR
- name: templates_dir
  value: $REPLI_TEMPLATES_DIR
- name: log_level
  value: $REPLI_LOG_LEVEL
- name: replicate_host
  value: $REPLICATE_HOST

commands:
# - { name: debug, help: Debug, private: true }
- name: new
  alias: ['n', init]
  help: Create a new configuration file from a tmeplate
  filters: [templates_dir_exists]

  args:
  - &template_search
    name: search
    help: Template search string or an exact name

  flags:
  - long: --use
    short: -u
    arg: path
    help: Path to repli file
    default: $REPLI_FILE
  - long: --force
    short: -f
    help: Overwrite target file
  - long: --exact
    short: -e
    help: Forces exact search only (disables interactive menu)

  examples:
  - repli new flux
  - repli new flux-schnell -e

- name: get
  alias: g
  help: Call Replicate using a configuration file and save the result

  args:
  - name: prefix
    help: Prefix for saved JSON file and output files

  flags:
  - long: --use
    short: -u
    arg: path
    help: Path to repli file
    default: $REPLI_FILE
    validate: file_exists

- name: edit
  alias: e
  help: Edit the repli file

  flags:
  - long: --use
    short: -u
    arg: path
    help: Path to repli file
    default: $REPLI_FILE
    validate: file_exists

- name: show
  alias: s
  help: Show the repli file

  flags:
  - long: --use
    short: -u
    arg: path
    help: Path to repli file
    default: $REPLI_FILE
    validate: file_exists

- name: env
  help: Show repli environment information

- name: info
  alias: i
  help: Get information on a model

  args:
  - name: model
    help: Model name on replicate
    required: true
    validate: model_name

  flags:
  - long: --example
    short: -e
    help: Show the example only
    conflicts: [--schema]
  - long: --schema
    short: -s
    help: Show the schema only
    conflicts: [--example]
  - &plain
    long: --plain
    short: -p
    help: Disable output colors
  - &json
    long: --json
    short: -j
    help: Output JSON instead of YAML

  examples:
  - repli info google/nano-banana
  - repli info google/nano-banana --example --plain --json

- name: template
  alias: t
  help: Manage templates
  commands:
  - name: new
    alias: ['n', add]
    help: Add a new template from a remote Replicate model example

    args:
    - name: model
      help: Replicate model (author/model)
      validate: model_name
      required: true

    flags:
    - long: --force
      short: -f
      help: Overwrite target file
    - long: --name
      short: -n
      arg: name
      help: Template name to save
      default: auto

    examples:
    - repli add google/nano-banana --name banana

  - name: list
    alias: [ls]
    help: Show list of templates
    filters: [templates_dir_exists]
    args:
    - name: search
      help: Template search string

  - name: grep
    help: Find templates that contain a string in their YAML
    filters: [templates_dir_exists]
    args:
    - name: search
      help: Search string
      required: true

  - name: show
    alias: s
    help: Show template
    filters: [templates_dir_exists]
    args: [*template_search]

  - name: edit
    alias: e
    help: Open template in editor
    filters: [templates_dir_exists]
    args: [*template_search]
    environment_variables:
    - name: editor
      help: Editor to use
      default: vi

  - name: delete
    alias: [d, del, rm]
    help: Delete template file
    filters: [templates_dir_exists]
    args: [*template_search]

- name: file
  alias: f
  help: Manage uploaded files

  commands:
  - name: list
    alias: [ls]
    help: Show list of uploaded files
    flags: [*plain, *json]

  - name: upload
    alias: u
    help: >
      Upload a file to Replicate

      Note that under normal conditions, there should be no reason for you to use this directly. Files will be uploaded automatically as needed.

    args:
    - name: file
      help: Path to file
      validate: file_exists
      required: true
